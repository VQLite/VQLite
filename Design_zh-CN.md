# Design

å…¶å®æ²¡å•¥è®¾è®¡ï¼Œéå¸¸ç®€å•ï¼Œä¸€çœ‹å°±ä¼šã€‚

## æ–‡ä»¶ç»“æ„
ç†è§£æ•°æ®å­˜æ”¾çš„æ–‡ä»¶ç»“æ„ä¹‹åå°±çŸ¥é“ VQLite çš„è®¾è®¡äº†ã€‚
```
vqlite_data/
`-- collection
    `-- segment_0
        |-- datasets.vql
        |-- index
        |   |-- ah_codebook.pb
        |   |-- datapoint_to_token.npy
        |   |-- dp_norms.npy
        |   |-- hashed_dataset.npy
        |   |-- int8_dataset.npy
        |   |-- int8_multipliers.npy
        |   |-- scann_assets.pbtxt
        |   |-- scann_config.pb
        |   `-- serialized_partitioner.pb
        |-- metadata.gob
        `-- vids.vql
```

è¿™é‡Œæˆ‘ä»¬å€Ÿé‰´~~æŠ„è¢­~~äº† Milvus çš„åšæ³•ï¼Œå¼•å…¥äº† collection çš„æ¦‚å¿µï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºæ•°æ®åº“ä¸­çš„åº“çš„æ¦‚å¿µã€‚

- vqlite_data æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜å‚¨äº†æ‰€æœ‰çš„ collection
- collection æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜å‚¨äº†æ‰€æœ‰çš„ segment
- segment_åºå· æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜å‚¨äº†æ‰€æœ‰çš„æ•°æ®
- metadata.gob æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œ æ˜¯ golang çš„å¯¹è±¡ï¼Œå­˜ç€å½“å‰ segment çš„åŸºç¡€ä¿¡æ¯ï¼Œä¹ŸåŒ…æ‹¬ å‘é‡å¯¹åº”çš„ metadata
- datasets.vql æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå­˜å‚¨äº†æ‰€æœ‰çš„å‘é‡
- vids.vql æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå­˜å‚¨äº†æ‰€æœ‰çš„å‘é‡å¯¹åº”çš„ vqid
- index æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ˜¯ ScaNN çš„ç´¢å¼•æ–‡ä»¶


## Document
å› ä¸º VQLite çš„æ“ä½œçš„æœ€å°å•å…ƒæ˜¯ `Document`ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ `Document` æ˜¯ä»€ä¹ˆã€‚

Document ç”±ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ç»„æˆ

|     å­—æ®µ      |         ç”¨é€”         |
|:-----------:|:------------------:|
|    vqid     | document çš„ idï¼Œ ä¸ä¸ºç©º |
|  metadata   |    å­˜å‚¨çš„å…ƒæ•°æ®ï¼Œå¯ä»¥ä¸ºç©º     |
|   vectors   |       å‘é‡ï¼Œä¸ä¸ºç©º       |
| vectors_tag |     å‘é‡çš„æ ‡è®°ï¼Œå¯ä»¥ä¸ºç©º     |

* vqid éœ€è¦ç”¨æˆ·è‡ªå·±æå‰å®šä¹‰å¥½ï¼Œè¿™ä¸ªå°±ç”¨æ¥ä»£è¡¨ document çš„ idï¼Œä¸èƒ½ä¸ºç©ºã€‚
* metadata å¯ä»¥éšä¾¿å¡ä»»ä½•ç±»å‹çš„æ•°æ®ï¼ˆä½†æ˜¯æ³¨æ„å°½é‡ä¿è¯æ’æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå°½å¯èƒ½çš„å°‘ï¼Œå› ä¸ºè¿™äº›æ•°æ®éƒ½å­˜åœ¨å†…å­˜é‡Œï¼‰ï¼Œå¯ä»¥ä¸ºç©ºã€‚
* vectors æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ª vector ä¹Ÿè¦å†™æˆæ•°ç»„çš„å½¢å¼ï¼Œä¸èƒ½ä¸ºç©ºã€‚
* vectors_tag ä¸ä¸Šé¢çš„ vector å¯¹åº”ï¼Œç”¨æ¥æ ‡è®° vector, è¿™é‡Œçš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ å¦‚ [1,2,3]
  ï¼Œé‡Œé¢çš„å€¼ä¸è¦å¤§äºuint32çš„æœ€å¤§å€¼ï¼ˆ4294967295ï¼‰ï¼Œå¯ä»¥ä¸ºç©ºï¼Œç©ºçš„æ—¶å€™ VQLite ä¼šæŒ‰ç…§å‘é‡çš„é¡ºåºç»™ä»–ä»¬ç”Ÿæˆ tagã€‚

ä¸‹é¢ä¸¾ä¸ª document å®é™…çš„ ğŸŒ° æ —å­ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€é¦–æ­Œæ›²æƒ³å…¥åº“ï¼š

```
{
    "vqid": "f8f78d25-23b0-4941-a7f4-7be66e6d8eea",
    "metadata": {"title":"Yellow", "artist":"coldplay"}
    "vectors": [[1,2,3], [4,5,6], [7,8,9]]
    "vectors_tag": [0, 60, 120]  
}
```

- vqid ä¸ºæˆ‘ä»¬ä¸ºè¿™é¦–æ­Œç”Ÿæˆçš„å”¯ä¸€ idï¼›
- metadata å­˜æ”¾æ­Œæ›²çš„æ­Œåæ­Œæ‰‹ä¿¡æ¯ï¼›
- vectors å­˜æ”¾éŸ³é¢‘çš„ embeddingï¼›
- vectors_tag åˆ™ç”¨æ¥å­˜æ”¾å¯¹åº” vectors çš„æ ‡è®°ï¼Œæ¯”å¦‚è¿™é‡Œå°±æ˜¯ç¬¬ä¸€ä¸ª vector æ˜¯ç¬¬ 0 ç§’çš„å†…å®¹ ç¬¬äºŒä¸ª vector å°±æ˜¯ç¬¬ 60 ç§’çš„å†…å®¹,ç¬¬ä¸‰ä¸ªæ˜¯ 120 ç§’çš„å†…å®¹ã€‚



## CRUD 

### Create

### Read

### Update

### Delete
